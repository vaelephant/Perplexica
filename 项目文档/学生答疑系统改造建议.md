# Perplexica 改造成学生答疑系统 - 详细改造建议

## 一、项目定位调整

### 1.1 核心定位变化
- **从**: 隐私优先的 AI 问答搜索引擎
- **到**: 面向学生的智能答疑解惑与学习辅助系统

### 1.2 目标用户群体
- 学生（小学、中学、大学）
- 教师（辅助教学、答疑）
- 自学者

### 1.3 核心价值主张
- 个性化学习辅导
- 题目解析与思路引导
- 知识点关联与复习
- 学习进度跟踪
- 错题本与复习管理

---

## 二、数据库架构扩展

### 2.1 现有表结构扩展

#### `chats` 表扩展
```typescript
// 新增字段
- subject: string          // 学科（数学、语文、英语等）
- grade: string            // 年级（小学、初中、高中、大学）
- topic: string            // 主题/知识点
- difficulty: number       // 难度等级（1-5）
- isHomework: boolean      // 是否为作业
- tags: string[]           // 标签（如：函数、几何、代数）
- studySessionId: string   // 学习会话ID
```

#### `messages` 表扩展
```typescript
// 新增字段
- questionType: string     // 问题类型（概念理解、计算、证明、应用等）
- knowledgePoints: string[] // 涉及的知识点
- difficulty: number       // 问题难度
- isCorrect: boolean       // 回答是否正确（针对测试题）
- userRating: number       // 用户评分（1-5）
- explanationQuality: string // 解释质量（good/bad/needs_improvement）
```

### 2.2 新增数据表

#### `study_sessions` - 学习会话表
```typescript
{
  id: string
  userId: string           // 用户ID（如果支持多用户）
  startTime: datetime
  endTime: datetime
  subject: string          // 学习科目
  totalQuestions: number   // 总问题数
  correctAnswers: number   // 正确答案数
  studyDuration: number    // 学习时长（分钟）
  topics: string[]         // 涉及的主题
}
```

#### `knowledge_points` - 知识点表
```typescript
{
  id: string
  name: string            // 知识点名称
  subject: string         // 学科
  grade: string           // 适用年级
  description: string     // 描述
  prerequisites: string[] // 前置知识点ID
  relatedPoints: string[] // 关联知识点ID
  difficulty: number      // 难度
  examples: string[]      // 示例问题
}
```

#### `question_bank` - 题库表
```typescript
{
  id: string
  question: string        // 题目内容
  answer: string          // 标准答案
  explanation: string     // 解析
  subject: string         // 学科
  grade: string           // 年级
  knowledgePoints: string[] // 知识点ID
  difficulty: number      // 难度
  questionType: string    // 题型
  source: string          // 来源（教材、试卷等）
  tags: string[]
  createdAt: datetime
}
```

#### `wrong_questions` - 错题本
```typescript
{
  id: string
  userId: string          // 用户ID
  questionId: string      // 题目ID（关联question_bank或直接存储）
  question: string        // 题目内容
  userAnswer: string      // 学生的答案
  correctAnswer: string   // 正确答案
  explanation: string     // 解析
  mistakeType: string     // 错误类型（计算错误、概念不清等）
  knowledgePoints: string[] // 涉及知识点
  wrongCount: number      // 错误次数
  lastWrongTime: datetime // 上次错误时间
  isMastered: boolean     // 是否已掌握
  notes: string           // 学生笔记
}
```

#### `study_progress` - 学习进度表
```typescript
{
  id: string
  userId: string
  knowledgePointId: string // 知识点ID
  masteryLevel: number    // 掌握程度（0-100）
  studyCount: number      // 学习次数
  lastStudyTime: datetime // 上次学习时间
  nextReviewTime: datetime // 下次复习时间（基于遗忘曲线）
}
```

#### `homework` - 作业表
```typescript
{
  id: string
  userId: string
  title: string           // 作业标题
  subject: string         // 科目
  description: string     // 作业描述
  questions: string[]     // 题目ID列表
  dueDate: datetime       // 截止日期
  status: string          // 状态（待完成、进行中、已完成）
  createdAt: datetime
  completedAt: datetime
}
```

---

## 三、核心功能模块改造

### 3.1 焦点模式（Focus Mode）重构

#### 新增学习模式替换原有搜索模式

**学科模式（Subject Modes）**
- `math` - 数学模式
  - 自动识别数学公式
  - 支持步骤化解题
  - 提供多种解题方法
- `physics` - 物理模式
  - 物理公式识别
  - 实验原理解释
- `chemistry` - 化学模式
  - 化学反应式
  - 实验步骤
- `english` - 英语模式
  - 语法检查
  - 写作辅导
- `chinese` - 语文模式
  - 阅读理解
  - 作文辅导
- `programming` - 编程模式
  - 代码解析
  - 调试帮助

**学习场景模式**
- `homework` - 作业模式
  - 题目解析
  - 思路引导（不直接给答案）
- `review` - 复习模式
  - 知识点回顾
  - 错题复习
- `test` - 测试模式
  - 限时答题
  - 自动评分
- `explain` - 讲解模式
  - 概念解释
  - 例题讲解

### 3.2 提示词系统优化

#### 针对学生的提示词设计

**数学题目解析提示词**
```
你是一位经验丰富的数学老师，擅长引导学生思考。

当学生提问数学问题时：
1. **不要直接给出答案**，而是引导思考过程
2. **分步骤讲解**，每一步都要解释原因
3. **提供多种解题方法**（如果适用）
4. **指出易错点**和常见错误
5. **总结解题思路**和关键步骤
6. **推荐相似题目**供练习

如果题目需要画图，用文字描述图形或建议画图辅助理解。
```

**作业模式提示词**
```
你是一位耐心负责的作业辅导老师。

辅导学生作业时的原则：
1. **启发式引导**：通过提问引导学生自己找到答案
2. **知识回顾**：先帮助学生回忆相关知识点
3. **思路分析**：分析题目考查的知识点和解题思路
4. **步骤讲解**：详细讲解每一步，解释为什么这样做
5. **检查验证**：引导学生检查答案的正确性
6. **举一反三**：给出类似的练习题

**重要**：不要直接给出完整答案，而是逐步引导学生。
```

**复习模式提示词**
```
你是一位帮助学生复习的老师，擅长梳理知识点和总结。

复习辅导时：
1. **知识框架**：先给出知识点的整体框架
2. **重点难点**：突出重难点内容
3. **知识关联**：说明与其他知识点的关联
4. **记忆方法**：提供记忆技巧和方法
5. **典型例题**：给出典型例题和解析
6. **易错点提醒**：总结常见错误和注意事项
```

### 3.3 题目识别与解析功能

#### 新增 API 端点

**`/api/questions/parse`** - 题目解析
```typescript
// 功能：识别题目类型、提取关键信息、识别知识点
{
  input: string,           // 用户输入的题目
  subject?: string,        // 学科（可选，用于辅助识别）
  returnFields: {
    questionType: boolean, // 题目类型
    knowledgePoints: boolean, // 知识点
    difficulty: boolean,   // 难度
    answerFormat: boolean  // 答案格式
  }
}
```

**`/api/questions/step-by-step`** - 步骤化解题
```typescript
// 功能：提供分步骤的解题过程
{
  question: string,
  subject: string,
  showHints: boolean,      // 是否显示提示
  hintLevel: number        // 提示详细程度（1-3）
}
```

### 3.4 知识点关联系统

#### 功能设计
- **前置知识点检测**：回答问题前，检查是否掌握前置知识
- **关联知识点推荐**：回答问题后，推荐相关知识点
- **知识图谱可视化**：展示知识点之间的关系

#### 实现方式
- 构建知识点知识库（可手动维护或从题库中提取）
- 使用嵌入模型计算知识点相似度
- 在回答中自动关联相关知识点

---

## 四、UI/UX 改造建议

### 4.1 界面主题调整

#### 学习友好的配色方案
- **护眼模式**：更柔和的背景色，减少蓝光
- **学科主题色**：不同学科使用不同主题色
  - 数学：蓝色系
  - 语文：红色系
  - 英语：绿色系
  - 物理：紫色系
  - 化学：橙色系

#### 界面布局优化
- **学习模式切换器**：更明显的学科/模式选择
- **进度指示器**：显示学习进度、掌握程度
- **快速工具栏**：常用功能快捷入口

### 4.2 新增核心组件

#### `QuestionInput` - 题目输入组件
```typescript
// 功能：
- 支持图片上传（拍照题目）
- 支持手写识别
- 题目类型自动识别
- 学科自动分类
```

#### `StepByStepSolution` - 分步解题组件
```typescript
// 功能：
- 显示解题步骤
- 每一步可展开/折叠
- 支持查看提示
- 支持查看多种解法
```

#### `KnowledgeGraph` - 知识点图谱组件
```typescript
// 功能：
- 可视化知识点关系
- 点击知识点查看详情
- 显示掌握程度
```

#### `StudyProgress` - 学习进度组件
```typescript
// 功能：
- 显示今日学习时长
- 显示各学科学习情况
- 显示知识点掌握情况
- 显示复习提醒
```

#### `WrongQuestionBook` - 错题本组件
```typescript
// 功能：
- 错题列表
- 按学科/知识点分类
- 错题详情查看
- 复习计划
```

#### `HomeworkTracker` - 作业跟踪组件
```typescript
// 功能：
- 作业列表
- 完成状态
- 截止日期提醒
- 作业详情
```

### 4.3 消息显示优化

#### 数学公式渲染
- 支持 LaTeX 公式显示
- 支持手写公式识别

#### 代码高亮
- 编程题目和代码使用语法高亮

#### 图表和图像
- 支持生成数学图形
- 支持物理示意图
- 支持化学结构式

---

## 五、新增功能模块

### 5.1 智能题目推荐

#### 功能描述
- 根据学生当前学习内容推荐相关题目
- 根据错题推荐相似题目
- 根据掌握程度推荐合适难度的题目

#### 实现方式
- 使用嵌入模型计算题目相似度
- 结合学生掌握程度和难度偏好
- 使用协同过滤算法

### 5.2 学习分析报告

#### 功能描述
- 生成学习周报/月报
- 分析学习强项和弱项
- 提供学习建议

#### 数据指标
- 学习时长统计
- 问题类型分布
- 知识点掌握情况
- 错误类型分析
- 学习趋势

### 5.3 复习计划系统

#### 功能描述
- 基于遗忘曲线的复习提醒
- 自动生成复习计划
- 复习进度跟踪

#### 实现方式
- 使用间隔重复算法（如 SM-2）
- 根据掌握程度调整复习间隔
- 智能推送复习提醒

### 5.4 题目拍照识别（OCR）

#### 功能描述
- 支持拍照上传题目
- OCR 识别题目文字
- 识别数学公式
- 识别手写内容

#### 技术方案
- 集成 OCR API（如 Google Vision、百度 OCR）
- 数学公式识别（MathPix API）
- 图像预处理和增强

### 5.5 语音输入/输出

#### 功能描述
- 语音提问
- 语音回答（TTS）
- 口语练习（英语模式）

#### 技术方案
- 语音识别（Web Speech API 或云端 API）
- 文本转语音（TTS）
- 语音评测（英语口语）

### 5.6 学习社区功能（可选）

#### 功能描述
- 学生之间分享学习笔记
- 讨论题目
- 学习小组

---

## 六、技术架构调整

### 6.1 新增服务/工具

#### 数学公式处理
- **MathJax/KaTeX**：前端公式渲染
- **MathPix API**：公式识别
- **SymPy**：符号计算

#### 图像处理
- **OCR 服务**：文字识别
- **图像增强**：提高识别准确度
- **图表生成**：数学图形、物理示意图

#### 语音处理
- **语音识别 API**
- **TTS API**
- **语音评测 API**

### 6.2 提示词工程优化

#### 分场景提示词模板库
```
prompts/
├── subjects/
│   ├── math.ts
│   ├── physics.ts
│   ├── chemistry.ts
│   ├── english.ts
│   └── chinese.ts
├── scenarios/
│   ├── homework.ts
│   ├── review.ts
│   ├── test.ts
│   └── explain.ts
└── templates/
    ├── step-by-step.ts
    ├── concept-explanation.ts
    └── problem-analysis.ts
```

### 6.3 API 端点扩展

#### 新增 API 路由
```
/api/
├── questions/
│   ├── parse          # 题目解析
│   ├── step-by-step   # 分步解题
│   └── similar        # 相似题目推荐
├── knowledge/
│   ├── points         # 知识点查询
│   ├── graph          # 知识图谱
│   └── related        # 关联知识点
├── study/
│   ├── progress       # 学习进度
│   ├── sessions       # 学习会话
│   └── analytics      # 学习分析
├── wrong-questions/   # 错题本
├── homework/          # 作业管理
└── ocr/               # OCR识别
```

---

## 七、配置和设置扩展

### 7.1 用户偏好设置

#### 新增设置项
- **学习阶段**：小学、初中、高中、大学
- **主要学科**：多选
- **学习目标**：提高成绩、兴趣学习、考试准备
- **难度偏好**：简单、中等、困难
- **引导程度**：高度引导、适度引导、直接解答
- **语言偏好**：中文、英文、双语

### 7.2 系统配置扩展

#### 教育相关配置
- **题库来源**：配置题目库
- **教材版本**：支持不同教材版本
- **考试类型**：高考、中考、会考等
- **知识点体系**：知识点数据库

---

## 八、数据迁移和初始化

### 8.1 初始化数据

#### 知识点库初始化
- 从教育标准中导入知识点
- 建立知识点层级关系
- 设置知识点难度

#### 题目库初始化（可选）
- 导入标准题目库
- 分类和标签化
- 难度标注

### 8.2 数据迁移脚本

#### 迁移现有聊天记录
- 提取学科信息（如果可能）
- 标注问题类型
- 关联知识点（通过嵌入模型）

---

## 九、开发优先级建议

### 第一阶段（MVP - 核心功能）
1. ✅ 数据库架构扩展（新增表结构）
2. ✅ 学科模式重构（数学、物理、化学等）
3. ✅ 作业模式提示词优化
4. ✅ 题目解析 API
5. ✅ 分步解题显示组件
6. ✅ 基础错题本功能

### 第二阶段（增强功能）
1. ⭐ 知识点关联系统
2. ⭐ 学习进度跟踪
3. ⭐ 复习计划系统
4. ⭐ 题目推荐算法
5. ⭐ 学习分析报告

### 第三阶段（高级功能）
1. 🔮 OCR 题目识别
2. 🔮 语音输入/输出
3. 🔮 知识图谱可视化
4. 🔮 学习社区（可选）

---

## 十、用户体验优化建议

### 10.1 引导和帮助

#### 新手引导
- 首次使用时的功能介绍
- 各模式使用说明
- 最佳实践建议

#### 帮助文档
- 使用教程
- 常见问题
- 学习技巧分享

### 10.2 反馈机制

#### 用户反馈
- 答案质量评价
- 解释清晰度评价
- 功能建议

#### 学习效果反馈
- 掌握程度自评
- 学习感受反馈
- 改进建议收集

### 10.3 激励机制

#### 学习成就系统
- 学习天数统计
- 问题数量里程碑
- 知识点掌握徽章
- 学习时长奖励

---

## 十一、隐私和安全考虑

### 11.1 学生隐私保护
- **数据加密**：敏感学习数据加密存储
- **本地优先**：尽量在本地处理数据
- **家长控制**：支持家长查看学习报告（可选）
- **数据匿名化**：学习分析数据匿名化

### 11.2 内容安全
- **内容审核**：过滤不当内容
- **学习导向**：确保内容适合学习
- **防止作弊**：作业模式下适度引导而非直接给答案

---

## 十二、测试和评估

### 12.1 功能测试
- 题目解析准确度
- 解题步骤正确性
- 知识点关联准确性
- 推荐算法效果

### 12.2 用户体验测试
- 学生使用反馈
- 教师使用反馈
- 学习效果评估

---

## 总结

这个改造方案将 Perplexica 从通用搜索引擎转变为专业的学生学习辅助系统。核心变化包括：

1. **功能定位**：从搜索转向学习辅导
2. **模式重构**：从搜索模式转向学科模式和学习场景模式
3. **数据扩展**：增加学习相关的数据模型
4. **提示词优化**：针对教育场景优化 AI 行为
5. **功能增强**：添加错题本、学习进度、复习计划等学习工具

建议采用迭代开发方式，先实现 MVP，然后根据用户反馈逐步完善功能。

---

**文档版本**: 1.0  
**创建日期**: 2024  
**后续更新**: 根据开发进展和用户反馈持续更新

