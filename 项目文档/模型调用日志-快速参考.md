# 模型调用日志快速参考

## 日志标记

- `[MODEL]` - 模型加载（聊天模型、嵌入模型）
- `[LLM]` - LLM 调用流程（搜索、回答、流式响应）
- `[CONTEXT]` - 上下文构建（网络搜索、文档重排序）
- `[CHAT]` - 聊天请求处理
- `[RERANK]` - 文档重排序和文件内容加载
- `[PROCESS_DOCS]` - 文档内容处理和格式化
- `[UPLOAD]` - 文件上传处理

## 完整调用流程日志示例

```
[CHAT] ===== 开始处理聊天请求 =====
[CHAT] 消息内容: ...
[CHAT] 加载模型...
[MODEL] ===== 开始加载聊天模型 =====
[MODEL] Provider ID: openai
[MODEL] Model Name: gpt-4
[MODEL] 聊天模型加载成功（耗时: 234ms）
[MODEL] ===== 开始加载嵌入模型 =====
[MODEL] 嵌入模型加载成功（耗时: 156ms）
[CHAT] 模型加载完成
[LLM] ===== 开始 LLM 搜索和回答流程 =====
[LLM] 创建回答链...
[CONTEXT] ===== 开始构建上下文 =====
[CONTEXT] 是否搜索网络: true/false
[LLM] 调用搜索检索链 LLM...（如果搜索网络）
[LLM] 搜索检索链 LLM 调用完成（耗时: 1234ms）
[CONTEXT] 开始重新排序文档...
[RERANK] ===== 开始处理文件内容 =====
[RERANK] 处理文件ID: xxx
[RERANK]   内容文件存在: true/false
[RERANK]   向量文件存在: true/false
[RERANK]   文件处理成功，返回 X 个对象
[RERANK] 最终返回文档数量: X
[CONTEXT] 重新排序完成，返回文档数量: X
[PROCESS_DOCS] ===== 开始处理文档内容 =====
[PROCESS_DOCS] 文档数量: X
[LLM] ===== 准备调用 LLM 生成最终响应 =====
[LLM] 开始调用 LLM...
[LLM] ===== 开始处理流式响应 =====
[LLM] 收到第一个响应块（耗时: 890ms）
[LLM] 流式响应完成（总耗时: 12345ms，首块时间: 890ms，总块数: 156）
[LLM] ===== LLM 搜索和回答流程完成（总耗时: 15678ms）=====
```

## 关键性能指标

1. **模型加载时间** - `[MODEL]` 日志中的耗时
2. **首块响应时间** - `[LLM] 收到第一个响应块（耗时: Xms）`
3. **总响应时间** - `[LLM] ===== LLM 搜索和回答流程完成（总耗时: Xms）=====`
4. **文件处理状态** - `[RERANK]` 日志中的文件加载情况

## 常见问题排查

### 文件无法加载
查看 `[RERANK]` 日志：
- 文件ID是否正确
- 文件路径是否存在
- 提取文件和向量文件是否存在

### LLM 响应慢
查看：
- `[LLM] 收到第一个响应块（耗时: Xms）` - 首块响应时间
- `[LLM] ===== LLM 搜索和回答流程完成（总耗时: Xms）=====` - 总耗时

### 文档内容为空
查看：
- `[RERANK] 最终返回文档数量: X`
- `[PROCESS_DOCS] 文档数量: X`
- `[PROCESS_DOCS] 警告:有文件上传但文档内容为空`

